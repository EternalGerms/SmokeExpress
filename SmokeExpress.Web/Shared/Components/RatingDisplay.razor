@* Projeto Smoke Express - Autores: Bruno Bueno e Matheus Esposto *@
@using MudBlazor

@if (HasRating)
{
    <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="0">
        @for (int i = 1; i <= 5; i++)
        {
            if (i <= EstrelasCheias)
            {
                <MudIcon Icon="@Icons.Material.Filled.Star" Style="@StarStyleFilled" />
            }
            else if (i == EstrelasCheias + 1 && TemMeiaEstrela)
            {
                <div style="position: relative; display: inline-block;">
                    <MudIcon Icon="@Icons.Material.Filled.Star" Style="@StarStyleEmpty" />
                    <div style="position: absolute; top: 0; left: 0; width: 50%; overflow: hidden;">
                        <MudIcon Icon="@Icons.Material.Filled.Star" Style="@StarStyleFilled" />
                    </div>
                </div>
            }
            else
            {
                <MudIcon Icon="@Icons.Material.Filled.Star" Style="@StarStyleEmpty" />
            }
        }
    </MudStack>
}

@code {
    /// <summary>
    /// Rating decimal (0-5) que permite exibir meia-estrela. Usado para médias de avaliações.
    /// </summary>
    [Parameter]
    public decimal? Rating { get; set; }

    /// <summary>
    /// Rating inteiro (1-5) que exibe apenas estrelas cheias ou vazias. Usado para avaliações individuais.
    /// </summary>
    [Parameter]
    public int? IntegerRating { get; set; }

    /// <summary>
    /// Tamanho da fonte CSS para as estrelas. Padrão: "1rem"
    /// </summary>
    [Parameter]
    public string StarSize { get; set; } = "1rem";

    /// <summary>
    /// Permite exibir meia-estrela quando Rating decimal é usado. Padrão: true.
    /// Ignorado quando IntegerRating é usado.
    /// </summary>
    [Parameter]
    public bool ShowHalfStar { get; set; } = true;

    private bool HasRating => IntegerRating.HasValue || Rating.HasValue;

    private int EstrelasCheias
    {
        get
        {
            if (IntegerRating.HasValue)
            {
                return IntegerRating.Value; // IntegerRating já é int, não precisa de Math.Floor
            }
            else if (Rating.HasValue)
            {
                return (int)Math.Floor(Rating.Value);
            }
            return 0;
        }
    }

    private bool TemMeiaEstrela
    {
        get
        {
            if (IntegerRating.HasValue)
            {
                return false; // Ratings inteiros não têm meia-estrela
            }
            else if (Rating.HasValue)
            {
                var estrelasCheias = (int)Math.Floor(Rating.Value);
                return ShowHalfStar && (Rating.Value - estrelasCheias >= 0.5m);
            }
            return false;
        }
    }

    private string StarStyleFilled => $"color: #ff9800; font-size: {StarSize};";
    private string StarStyleEmpty => $"color: #e0e0e0; font-size: {StarSize};";
}

