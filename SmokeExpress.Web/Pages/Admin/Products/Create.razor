@page "/admin/produtos/novo"
@attribute [Authorize(Roles = "Admin")]
@inject IProductService ProductService
@inject NavigationManager Navigation
@inject ILogger<Create> Logger

@* Projeto Smoke Express - Autores: Bruno Bueno e Matheus Esposto *@

<h3 class="mb-4">Novo Produto</h3>

@if (!string.IsNullOrEmpty(_mensagemErro))
{
    <div class="alert alert-danger" role="alert">@_mensagemErro</div>
}

<ProductForm OnSave="HandleSave" />

@code {
    private string? _mensagemErro;

    private async Task HandleSave(Product produto)
    {
        _mensagemErro = null;

        try
        {
            if (produto is null)
            {
                _mensagemErro = "Produto inv√°lido.";
                StateHasChanged();
                return;
            }

            Logger.LogInformation("Criando produto. Nome: {Nome}, CategoriaId: {CategoriaId}", produto.Nome, produto.CategoriaId);
            await ProductService.CriarAsync(produto);
            Logger.LogInformation("Produto criado com sucesso. ProductId: {ProductId}, Nome: {Nome}", produto.Id, produto.Nome);
            Navigation.NavigateTo("/admin/produtos?success=created");
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Erro ao criar produto");
            _mensagemErro = $"Erro ao criar produto: {ex.Message}";
            StateHasChanged();
        }
    }
}

