@page "/account/login"
@attribute [AllowAnonymous]
@inject NavigationManager Navigation
@using SmokeExpress.Web.Shared.FormControls

@* Projeto Smoke Express - Autores: Bruno Bueno e Matheus Esposto *@

<div class="page-login">
    <div class="login-card">
        <div class="login-header">
            <h2 class="title">Entrar</h2>
            <p class="subtitle">Use o e-mail e a senha cadastrados para acessar.</p>
        </div>

        @if (!string.IsNullOrEmpty(MensagemErro))
        {
            <div class="alert alert-danger mb-4" role="alert">@MensagemErro</div>
        }

        <form method="post" action="/account/login" class="login-form" novalidate>
            <input type="hidden" name="ReturnUrl" value="@ReturnUrl" />
            <input type="hidden" name="RememberMe" value="false" />

            <TextField Label="E-mail"
                       InputId="email"
                       InputType="email"
                       Hint="Informe um e-mail válido."
                       @bind-Value="Email"
                       name="Email" />

        <PasswordField Label="Senha"
                       InputId="senha"
                       Hint="Informe a senha."
                       @bind-Value="Password"
                       name="Password"
                       ShowPasswordLabel="Mostrar senha digitada"
                       HidePasswordLabel="Ocultar senha digitada" />

            <CheckboxField CssClass="mb-4"
                           InputId="lembrar"
                           Label="Manter-me conectado"
                           name="RememberMe"
                           @bind-Value="RememberMe" />

            <PrimaryButton Type="submit" CssClass="w-100">Entrar</PrimaryButton>
            <SecondaryButton Type="button" CssClass="w-100 mt-3" OnClick="NavegarParaCadastro">Criar uma conta</SecondaryButton>
        </form>
    </div>
</div>

@code {
    [SupplyParameterFromQuery(Name = "returnUrl")]
    public string? ReturnUrlQuery { get; set; }
        = "/";

    [SupplyParameterFromQuery(Name = "error")]
    public string? ErrorCode { get; set; }
        = null;

    private string Email { get; set; } = string.Empty;

    private string Password { get; set; } = string.Empty;

    private bool RememberMe { get; set; }
        = false;

    private string ReturnUrl => string.IsNullOrWhiteSpace(ReturnUrlQuery) ? "/" : ReturnUrlQuery;

    private string? MensagemErro => ErrorCode switch
    {
        "locked" => "Conta temporariamente bloqueada por tentativas inválidas. Tente novamente mais tarde.",
        "invalid" => "Credenciais inválidas. Verifique o e-mail e a senha informados.",
        _ => null
    };

    private void NavegarParaCadastro()
    {
        Navigation.NavigateTo("/account/register");
    }
}

